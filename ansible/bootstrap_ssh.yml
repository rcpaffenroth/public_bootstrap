---
- name: Bootstrap ssh keys
  # This does the setup of the user rcpaffenroth and makes sure everything  
  # is current for then.  Note, this does not require root.
  hosts: localhost
  become: false
  gather_facts: false
  environment:

  tasks:
    - name: Include vault variables
      include_vars:
        file: vault.yml

    - name: Create .ssh directory
      file:
        path: $HOME/.ssh
        state: directory
        mode: "700"

    - name: Make the private key file
      lineinfile:
        dest: $HOME/.ssh/id_ed25519
        state: present
        line: "{{ ssh_private }}"
        mode: "600"
        create: yes

    - name: Make the private key file
      lineinfile:
        dest: $HOME/.ssh/id_ed25519.pub
        state: present
        line: "{{ ssh_public }}"
        mode: "600"
        create: yes