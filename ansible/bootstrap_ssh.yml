---
- name: Bootstrap ssh keys
  # This does the setup of the user rcpaffenroth and makes sure everything
  # is current for then.  Note, this does not require root.
  hosts: localhost
  become: false
  gather_facts: false
  environment:

  tasks:
    - name: Include vault variables
      include_vars:
        file: vault.yml

    - name: Make the private key file
      lineinfile:
        dest: bootstrap_ssh
        state: present
        line: "{{ ssh_private }}"
        mode: "600"
        create: yes

    - name: Get ssh
      git:
        repo: rcpaffenroth@moc-gateway.rcpaffenroth.org:repos/ssh.git
        dest: ssh
        key_file: bootstrap_ssh
        accept_hostkey: yes
        update: yes

    - name: Clean up
      file:
        path: bootstrap_ssh
        state: absent

    - name: Tell the user what to do next...
      ansible.builtin.debug:
        msg:
          - "You now have an ssh directory"
          - "You should copy this to .ssh"
